<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Job Resume Customizer</title>
   <style>
      * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
      }

      body {
         font-family:
            -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
            Cantarell, sans-serif;
         line-height: 1.6;
         color: #1a1a2e;
         background: #f8f9fa;
         min-height: 100vh;
         padding: 40px 20px;
         display: flex;
         align-items: flex-start;
         justify-content: center;
      }

      .container {
         max-width: 560px;
         width: 100%;
      }

      .card {
         background: white;
         border-radius: 16px;
         box-shadow: 0 4px 24px rgba(26, 26, 46, 0.08);
         padding: 40px;
         margin-bottom: 24px;
      }

      h1 {
         color: #1a1a2e;
         margin-bottom: 8px;
         font-size: 1.75rem;
         font-weight: 700;
         letter-spacing: -0.02em;
      }

      .subtitle {
         color: #6b7280;
         margin-bottom: 32px;
         font-size: 0.95rem;
      }

      .form-group {
         margin-bottom: 24px;
      }

      label {
         display: block;
         margin-bottom: 8px;
         font-weight: 500;
         color: #1a1a2e;
         font-size: 0.875rem;
      }

      input[type="password"],
      textarea {
         width: 100%;
         padding: 14px 16px;
         background: #f5f5f7;
         border: 1px solid transparent;
         border-radius: 10px;
         font-size: 15px;
         font-family: inherit;
         color: #1a1a2e;
         transition: all 0.2s ease;
      }

      input[type="password"]::placeholder,
      textarea::placeholder {
         color: #9ca3af;
      }

      input[type="password"]:focus,
      textarea:focus {
         outline: none;
         background: white;
         border-color: #1a1a2e;
         box-shadow: 0 0 0 3px rgba(26, 26, 46, 0.08);
      }

      textarea {
         min-height: 140px;
         resize: vertical;
      }

      button {
         background: #1a1a2e;
         color: white;
         padding: 16px 32px;
         border: none;
         border-radius: 10px;
         font-size: 15px;
         font-weight: 600;
         cursor: pointer;
         transition: all 0.2s ease;
         width: 100%;
      }

      button:hover:not(:disabled) {
         background: #2d2d44;
      }

      button:disabled {
         opacity: 0.5;
         cursor: not-allowed;
      }

      .help-text {
         font-size: 0.8rem;
         color: #9ca3af;
         margin-top: 8px;
      }

      .help-link {
         display: block;
         text-align: center;
         margin-top: 16px;
         color: #1a1a2e;
         font-size: 0.875rem;
         text-decoration: none;
         opacity: 0.7;
         transition: opacity 0.2s;
      }

      .help-link:hover {
         opacity: 1;
         text-decoration: underline;
      }

      .result {
         display: none;
      }

      .result.show {
         display: block;
      }

      .result-section {
         margin-bottom: 24px;
      }

      .result-section:last-child {
         margin-bottom: 0;
      }

      .result-section h3 {
         color: #1a1a2e;
         margin-bottom: 12px;
         font-size: 1rem;
         font-weight: 600;
      }

      .result-content {
         background: #f5f5f7;
         padding: 16px;
         border-radius: 10px;
      }

      pre {
         white-space: pre-wrap;
         word-wrap: break-word;
         font-family: "SF Mono", "Fira Code", "Consolas", monospace;
         font-size: 13px;
         line-height: 1.6;
         color: #374151;
      }

      .error {
         background: #fef2f2;
         color: #991b1b;
      }

      .form-error {
         background: #fef2f2;
         color: #991b1b;
         padding: 12px;
         border-radius: 8px;
         margin-bottom: 24px;
         display: none;
         font-size: 0.9rem;
      }

      .loading {
         text-align: center;
         padding: 32px 20px;
         color: #6b7280;
      }

      .spinner {
         border: 3px solid #e5e7eb;
         border-top: 3px solid #1a1a2e;
         border-radius: 50%;
         width: 32px;
         height: 32px;
         animation: spin 0.8s linear infinite;
         margin: 0 auto 12px;
      }

      @keyframes spin {
         0% {
            transform: rotate(0deg);
         }

         100% {
            transform: rotate(360deg);
         }
      }

      .changes-list {
         list-style: none;
         padding: 0;
      }

      .changes-list li {
         padding: 10px 0;
         border-bottom: 1px solid #e5e7eb;
         font-size: 0.9rem;
      }

      .changes-list li:last-child {
         border-bottom: none;
         padding-bottom: 0;
      }

      h2 {
         color: #1a1a2e;
         font-size: 1.25rem;
         font-weight: 600;
         margin-bottom: 24px;
      }
   </style>
</head>

<body>
   <div class="container">
      <div class="card">
         <h1>Resume Customizer</h1>
         <p class="subtitle">Refine your profile for the perfect opportunity.</p>

         <form id="customizeForm">
            <div class="form-group">
               <label for="apiToken">API Token</label>
               <input type="password" id="apiToken" name="apiToken" placeholder="Enter your API token" required>
               <p class="help-text">
                  Your API token is stored locally and never sent to external
                  servers.
               </p>
            </div>

            <div class="form-group">
               <label for="jobInput">Job Posting</label>
               <textarea id="jobInput" name="jobInput" placeholder="Paste the job description or URL here..."
                  required></textarea>
            </div>

            <div id="formError" class="form-error"></div>

            <button type="submit" id="submitBtn">Generate Custom Resume</button>
         </form>

         <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Processing your request...</p>
         </div>
      </div>

      <div id="result" class="result">
         <div class="card">
            <h2>Results</h2>

            <div class="result-section">
               <h3>Job Information</h3>
               <div id="jobInfo" class="result-content"></div>
            </div>

            <div class="result-section">
               <h3>Reasoning</h3>
               <div id="reasoning" class="result-content"></div>
            </div>

            <div class="result-section">
               <h3>Changes Made</h3>
               <div id="changes" class="result-content"></div>
            </div>

            <div class="result-section">
               <h3>Customized Resume</h3>
               <div id="customizedResume" class="result-content"></div>
            </div>
         </div>
      </div>
   </div>

   <script>
      "use strict";
      // Load API token from localStorage on page load
      const apiTokenInput = document.getElementById("apiToken");
      const savedToken = localStorage.getItem("apiToken");
      if (savedToken) {
         apiTokenInput.value = savedToken;
      }

      // Save API token to localStorage when it changes
      apiTokenInput.addEventListener("change", (e) => {
         localStorage.setItem("apiToken", e.target.value);
      });

      // Handle form submission
      const form = document.getElementById("customizeForm");
      const submitBtn = document.getElementById("submitBtn");
      const loading = document.getElementById("loading");
      const result = document.getElementById("result");

      form.addEventListener("submit", async (e) => {
         e.preventDefault();

         const apiToken = apiTokenInput.value.trim();
         const jobInput = document.getElementById("jobInput").value.trim();
         const formError = document.getElementById("formError");

         if (!(apiToken && jobInput)) {
            formError.textContent = "Please fill in all fields";
            formError.style.display = "block";
            return;
         }
         formError.style.display = "none";

         // Save token
         localStorage.setItem("apiToken", apiToken);

         // Show loading, hide results
         submitBtn.disabled = true;
         loading.style.display = "block";
         result.classList.remove("show");

         try {
            const response = await fetch("/api/customize", {
               method: "POST",
               headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${apiToken}`,
               },
               body: JSON.stringify({ input: jobInput }),
            });

            const data = await response.json();

            if (!response.ok) {
               throw new Error(
                  data.error || `Request failed with status ${response.status}`
               );
            }

            // Display results
            displayResults(data);
            result.classList.add("show");
         } catch (error) {
            displayError(error.message);
            result.classList.add("show");
         } finally {
            submitBtn.disabled = false;
            loading.style.display = "none";
         }
      });

      function displayResults(data) {
         // Job Information
         const jobInfo = document.getElementById("jobInfo");
         jobInfo.className = "result-content";
         jobInfo.innerHTML = `
                <p><strong>Company:</strong> ${escapeHtml(data.job.company)}</p>
                <p><strong>Title:</strong> ${escapeHtml(data.job.title)}</p>
                ${data.job.location ? `<p><strong>Location:</strong> ${escapeHtml(data.job.location)}</p>` : ""}
            `;

         // Reasoning
         const reasoning = document.getElementById("reasoning");
         reasoning.className = "result-content";
         reasoning.innerHTML = `<pre>${escapeHtml(data.reasoning)}</pre>`;

         // Changes
         const changes = document.getElementById("changes");
         changes.className = "result-content";
         if (data.changes && data.changes.length > 0) {
            const changesList = data.changes
               .map((change) => `<li>${escapeHtml(change)}</li>`)
               .join("");
            changes.innerHTML = `<ul class="changes-list">${changesList}</ul>`;
         } else {
            changes.innerHTML = "<p>No changes made.</p>";
         }

         // Customized Resume
         const customizedResume = document.getElementById("customizedResume");
         customizedResume.className = "result-content";
         customizedResume.innerHTML = `<pre>${escapeHtml(JSON.stringify(data.customized, null, 2))}</pre>`;
      }

      function displayError(message) {
         const jobInfo = document.getElementById("jobInfo");
         jobInfo.className = "result-content error";
         jobInfo.innerHTML = `<p><strong>Error:</strong> ${escapeHtml(message)}</p>`;

         document.getElementById("reasoning").innerHTML = "";
         document.getElementById("changes").innerHTML = "";
         document.getElementById("customizedResume").innerHTML = "";
      }

      function escapeHtml(text) {
         const div = document.createElement("div");
         div.textContent = text;
         return div.innerHTML;
      }
   </script>
</body>

</html>